# 作業メモ

## 設計方針

- 洗練されたファットコントローラパターン
- HttpBadRequestExceptionによる簡易で高度なエラーハンドリング
- モデルはアプリケーションにとって不十分なものであり、ストレージにとって十分なものを提供する。
- モデルのアプリケーションレイヤにおける不十分性はService層が吸収する。
- アプリケーションモジュールはServiceのみがモデルモジュールに依存する(結合部の限定)gi

## モジュール構成

### app

アプリケーションとトークンに関するストレージとエンティティの管理。

### auth

認証とユーザに関するストレージとエンティティの管理　

### httpbase

基本的なアプリエンティティ操作とトークン管理に関する
コントローラロジックの提供

### httpauth

ユーザ認証と、ユーザデータ管理に関する
コントローラロジックの提供

## テスト方針

### モデルモジュールのテスト

- リポジトリとエンティティはテストを行う。
- スキーマは不要
- マッパーのテストは、リポジトリのテストを行えば十分な気がする。

### アプリモジュールのテスト　

- 基本テストしない(テストが必要なロジックをぶち込まない)。
- モジュール利用側プロジェクトでcodeceptionのBDD試験を実施する(稼働中テストも込で)
- BDD用のヘルパー、トレイトはたくさん準備する。

## テーブル名の依存注入管理

- 基本諦める。
- eloquent使わない。意味ない。
- テーブル名変えたかったらProvider継承しろ、alter migrateかけろ、でOKだと思う。

## TODO

- モデル側バリデーションの実装
  - nameが250文字とかはストレージ都合なので、リポジトリロジック
  - 基本は全てアプリ側でカバーするべきなので単純例外でOK。
  - ストレージ的に保存可能かどうかの検証のみ
- アプリ側バリデーションの実装
  - Requestで行う。
  - 入力変数(文字列)を型付きオブジェクトに変換するところまでがRequestの責務(パススルーのRequestはいらない)

- apiドキュメント作る